!function(){function t(e){return(t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(e=function(){return!!t})()}function n(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function s(t,e,n){if(!e.has(t))throw TypeError("attempted to get private field on non-instance");return n}function i(t,e){!function(t,e){if(e.has(t))throw TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function r(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function a(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(e,n,s){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,s){var i=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=t(e)););return e}(e,n);if(i){var r=Object.getOwnPropertyDescriptor(i,n);return r.get?r.get.call(s||e):r.value}})(e,n,s||e)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var c,u={};function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function d(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(t,e)}}function g(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n,s,i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r=[],a=!0,o=!1;try{for(i=i.call(t);!(a=(n=i.next()).done)&&(r.push(n.value),!e||r.length!==e);a=!0);}catch(t){o=!0,s=t}finally{try{a||null==i.return||i.return()}finally{if(o)throw s}}return r}}(t,e)||d(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||d(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var y="playing",m={start:"msgStart",lose:"msgLose",win:"msgWin"},w={w:"w",a:"a",s:"s",d:"d",ArrowUp:"ArrowUp",ArrowLeft:"ArrowLeft",ArrowDown:"ArrowDown",ArrowRight:"ArrowRight"},p=function(){return Array.from({length:10},function(t,e){return 9===e?4:2})[Math.floor(10*Math.random())]},_=function(){return Math.floor(4*Math.random()+0)},b=function(t){var e=t.field,n=t.exclude,s=void 0===n?[]:n,i=g(s,2),r=i[0],a=i[1],o=_(),l=_(),c=!!e[l][o];return o===r&&l===a||c?b({field:e,exclude:s}):[o,l]},k=function(t){for(var e=v(t),n=0,s=!1,i=0;i<e.length;i++)if(e[i]===e[i+1]){var r=2*e[i];s=2048===r,n+=r,e[i]=r,e[i+1]=0}return{row:e,counter:n,is2048:s}},S=function(t){return t.filter(function(t){return!!t})},L=function(t){var e=Array.from({length:4-t.length},function(){return 0});return t.concat(e)},C=function(t){for(var e=function(e){t.forEach(function(s,i){n[3-i][e]=t[e][i]})},n=Array.from({length:4},function(){return[]}),s=0;s<4;s++)e(s);return n},A=function(t){for(var e=function(e){t.forEach(function(s,i){n[i][3-e]=t[e][i]})},n=Array.from({length:4},function(){return[]}),s=0;s<4;s++)e(s);return n},E=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.field,n=t.rtl,s=void 0!==n&&n,i=0,r=!1,a=!1,o=0;o<e.length;o++)!function(t){var n=s?e[t].reverse():e[t],o=k(S(n)),l=o.row,c=o.counter,u=o.is2048;i+=c,r=u;var h=L(S(l));a=a||n.some(function(t,e){return t!==h[e]}),e[t]=s?h.reverse():h}(o);return{field:e,score:i,isWinner:r,wasChanged:a}},W=function(t){var e=t.field,n=t.rtl,s=C(e),i=E({field:s,rtl:void 0!==n&&n}),r=i.score,a=i.isWinner,o=i.wasChanged;return{field:s=A(s),score:r,isWinner:a,wasChanged:o}},B=new WeakSet,M=new WeakSet,O=new WeakSet,j=new WeakSet,R=new WeakSet,I=new WeakSet,P=new WeakSet,T=new WeakSet,F=new WeakSet,N=new WeakSet,x=new WeakSet;function D(t){var e=t.key;t.show?this.messages[e].classList.remove("hidden"):this.messages[e].classList.add("hidden")}function U(t){this.field=t}function z(t){this.score+=t}function G(){var t=Array.from({length:4},function(){return[0,0,0,0]});s(this,M,U).call(this,t)}function H(){var t=this._getField(),e=g(b({field:t}),2),n=e[0],i=e[1],r=g(b({field:t,exclude:[n,i]}),2),a=r[0],o=r[1];t[i][n]=p(),t[o][a]=p(),s(this,M,U).call(this,t)}function Y(t){t.classList.add("container");var e=document.createElement("div"),n=document.createElement("table"),s=document.createElement("div");e.classList.add("game-header"),n.classList.add("game-field"),s.classList.add("message-container"),e.innerHTML='<h1>2048</h1>\n  <div class="controls">\n    <p class="info">\n      Score:\n      <span class="game-score" id="game-score">0</span>\n    </p>\n    <button\n      class="button start"\n        id="start"\n      >\n      Start\n    </button>\n    <button\n      class="button restart hidden"\n        id="restart"\n      >\n      Restart\n    </button>\n  </div>',n.innerHTML='<tbody>\n    <tr class="field-row">\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n    </tr>\n\n    <tr class="field-row">\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n    </tr>\n\n    <tr class="field-row">\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n    </tr>\n\n    <tr class="field-row">\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n      <td class="field-cell"></td>\n    </tr>\n  </tbody>',s.innerHTML='<p class="message message-lose hidden" id="message-lose">You lose! Restart the game?</p>\n  <p class="message message-win hidden" id="message-win">Winner! Congrats! You did it!</p>\n  <p class="message message-start hidden" id="message-start">\n    Press "Start" to begin game. Good luck!\n  </p>',t.append(e,n,s)}function q(){this.controls={startBtn:document.getElementById("start"),restartBtn:document.getElementById("restart")}}function $(){this.messages={msgWin:document.getElementById("message-win"),msgLose:document.getElementById("message-lose"),msgStart:document.getElementById("message-start")}}function J(){return this._getField().some(function(t){return t.some(function(t){return!t})})}function K(){for(var t=this._getField(),e=0;e<t.length;e++)for(var n=t[e],s=0;s<n.length;s++)if(n[s]===n[s+1])return!0;for(var i=C(t),r=0;r<i.length;r++)for(var a=i[r],o=0;o<a.length;o++)if(a[o]===a[o+1])return!0;return!1}function Q(){this._setStatus("win"),this._showWinMessage()}u=function(){function t(){n(this,t),i(this,B),i(this,M),i(this,O),i(this,j),i(this,R),i(this,I),i(this,P),i(this,T),i(this,F),i(this,N),i(this,x),h(this,"field",null),h(this,"score",0),h(this,"fieldControls",{}),h(this,"status",null),h(this,"messages",{})}return a(t,[{key:"_setStatus",value:function(t){this.status=t}},{key:"_getStatus",value:function(){return this.status}},{key:"_getScore",value:function(){return this.score}},{key:"_getField",value:function(){return v(this.field)}},{key:"_setStatusIdle",value:function(){this._setStatus("idle")}},{key:"_setStatusWin",value:function(){this._setStatus("win")}},{key:"_setStatusLose",value:function(){this._setStatus("lose")}},{key:"_setStatusPlaying",value:function(){this._setStatus(y)}},{key:"_showStartMessage",value:function(){s(this,B,D).call(this,{key:m.start,show:!0})}},{key:"_showWinMessage",value:function(){s(this,B,D).call(this,{key:m.win,show:!0})}},{key:"_showLoseMessage",value:function(){s(this,B,D).call(this,{key:m.lose,show:!0})}},{key:"_hideMessages",value:function(){for(var t in m)s(this,B,D).call(this,{key:m[t],show:!1})}},{key:"_setupNewGame",value:function(){s(this,j,G).call(this),s(this,R,H).call(this),this._setStatusPlaying()}},{key:"_initialize",value:function(t){s(this,I,Y).call(this,t),s(this,P,q).call(this),s(this,T,$).call(this)}},{key:"_rerender",value:function(){var t=document.querySelectorAll(".field-cell"),e=document.getElementById("game-score"),n=this._getField(),i=this._getScore();n.forEach(function(e,n){e.forEach(function(e,s){var i=t[s+4*n];e?(i.className="field-cell",i.classList.add("field-cell--".concat(e)),i.textContent=e):(i.textContent="",i.className="field-cell")})}),e.textContent=i;var r=s(this,F,J).call(this),a=s(this,N,K).call(this);r||a||(this._setStatusLose(),this._showLoseMessage())}},{key:"_createNewCell",value:function(){if(s(this,F,J).call(this)){var t=this._getField(),e=g(b({field:t}),2),n=e[0];t[e[1]][n]=p(),s(this,M,U).call(this,t)}}},{key:"_shiftLeft",value:function(){var t=E({field:this._getField()}),e=t.field,n=t.score,i=t.isWinner,r=t.wasChanged;return s(this,O,z).call(this,n),s(this,M,U).call(this,e),i&&s(this,x,Q).call(this),{wasChanged:r}}},{key:"_shiftRight",value:function(){var t=E({field:this._getField(),rtl:!0}),e=t.field,n=t.score,i=t.isWinner,r=t.wasChanged;return s(this,O,z).call(this,n),s(this,M,U).call(this,e),i&&s(this,x,Q).call(this),{wasChanged:r}}},{key:"_shiftTop",value:function(){var t=W({field:this._getField()}),e=t.field,n=t.score,i=t.isWinner,r=t.wasChanged;return s(this,O,z).call(this,n),s(this,M,U).call(this,e),i&&s(this,x,Q).call(this),{wasChanged:r}}},{key:"_shiftBottom",value:function(){var t=W({field:this._getField(),rtl:!0}),e=t.field,n=t.score,i=t.isWinner,r=t.wasChanged;return s(this,O,z).call(this,n),s(this,M,U).call(this,e),i&&s(this,x,Q).call(this),{wasChanged:r}}}]),t}();var V=new WeakSet;function X(){var t=this;this.controls.startBtn.addEventListener("click",this.start.bind(this)),this.controls.restartBtn.addEventListener("click",this.restart.bind(this)),document.addEventListener("keyup",function(e){switch(e.key){case w.w:case w.ArrowUp:t.moveUp();break;case w.a:case w.ArrowLeft:t.moveLeft();break;case w.s:case w.ArrowDown:t.moveDown();break;case w.d:case w.ArrowRight:t.moveRight()}})}var Z=new(function(r){function c(){var s,r,a,o;return n(this,c),r=c,a=arguments,r=t(r),i(s=(o=e()?Reflect.construct(r,a||[],t(this).constructor):r.apply(this,a))&&("object"==(o&&"undefined"!=typeof Symbol&&o.constructor===Symbol?"symbol":typeof o)||"function"==typeof o)?o:function(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(this),V),s}return!function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(c,r),a(c,[{key:"initialize",value:function(e){o(t(c.prototype),"_initialize",this).call(this,e),s(this,V,X).call(this),this._setStatusIdle(),this._showStartMessage()}},{key:"getScore",value:function(){return this._getScore()}},{key:"getState",value:function(){return this._getState()}},{key:"getStatus",value:function(){return this._getStatus()}},{key:"start",value:function(){this._setupNewGame(),this.controls.startBtn.removeEventListener("click",this.start.bind(this)),this.controls.startBtn.classList.add("hidden"),this.controls.restartBtn.classList.remove("hidden"),this._hideMessages(),this._rerender()}},{key:"restart",value:function(){this._hideMessages(),this._setupNewGame(),this._rerender()}},{key:"moveLeft",value:function(){this._getStatus()===y&&(this._shiftLeft().wasChanged&&this._createNewCell(),this._rerender())}},{key:"moveRight",value:function(){this._getStatus()===y&&(this._shiftRight().wasChanged&&this._createNewCell(),this._rerender())}},{key:"moveUp",value:function(){this._getStatus()===y&&(this._shiftTop().wasChanged&&this._createNewCell(),this._rerender())}},{key:"moveDown",value:function(){this._getStatus()===y&&(this._shiftBottom().wasChanged&&this._createNewCell(),this._rerender())}}]),c}((c=u)&&c.__esModule?c.default:c)),tt=document.getElementById("game-2048");tt&&Z.initialize(tt)}();
//# sourceMappingURL=index.1643b963.js.map
